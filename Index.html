<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONPI Pre-Sale</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.39.0/dist/index.iife.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-wallets@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react@latest"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: url('https://i.postimg.cc/SX25dNr3/onpi-background.png') no-repeat center center fixed;
            background-size: cover;
            color: white;
        }
        #connect-button, #buy-button {
            background-color: #ff6600;
            border: none;
            padding: 15px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Welcome to ONPI Pre-Sale</h1>
    <img src="https://i.postimg.cc/WqPQhL0K/onpi.png" alt="ONPI Logo" style="width: 200px; height: auto;">
    
    <!-- Conectare portofel -->
    <button id="connect-button">Connect Wallet</button>
    
    <!-- Buton de cumpărare -->
    <button id="buy-button" style="display: none;">Buy Now</button>

    <script>
        const walletButton = document.getElementById("connect-button");
        const buyButton = document.getElementById("buy-button");

        let connectedWallet = null;
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("devnet"));

        const { SystemProgram } = solanaWeb3;
        
        // Verifică dacă portofelul Solana este instalat
        if (window.solana && window.solana.isPhantom) {
            walletButton.disabled = false;
            walletButton.textContent = 'Connect Phantom Wallet';
        } else {
            walletButton.disabled = true;
            walletButton.textContent = 'Install Phantom Wallet';
        }

        // Conectează portofelul
        walletButton.addEventListener('click', async () => {
            try {
                if (window.solana && window.solana.isPhantom) {
                    // Conectare la portofelul Phantom
                    await window.solana.connect();
                    connectedWallet = window.solana.publicKey.toString();
                    walletButton.textContent = `Wallet Connected: ${connectedWallet}`;
                    buyButton.style.display = 'block'; // Arată butonul de cumpărare
                } else {
                    alert("Please install Phantom Wallet.");
                }
            } catch (error) {
                console.log("Connection failed: ", error);
            }
        });

        // Cumpără ONPI
        buyButton.addEventListener('click', async () => {
            try {
                if (!connectedWallet) {
                    alert("Please connect your wallet first!");
                    return;
                }

                const buyerPublicKey = new solanaWeb3.PublicKey(connectedWallet);
                const senderWallet = window.solana;

                // Adresa contractului ONPI
                const onpiAddress = new solanaWeb3.PublicKey("4dnv1yjdmYYdBKLkMokGLVNxCpyxQrD2yi6MRbtPU5DK");

                // Crearea unei tranzacții
                const transaction = new solanaWeb3.Transaction().add(
                    SystemProgram.transfer({
                        fromPubkey: buyerPublicKey,
                        toPubkey: onpiAddress,
                        lamports: 0.03 * solanaWeb3.LAMPORTS_PER_SOL, // Exemplu de suma (0.03 SOL)
                    })
                );

                // Semnarea tranzacției
                const signedTransaction = await senderWallet.signTransaction(transaction);

                // Trimiterea tranzacției
                const signature = await connection.sendRawTransaction(signedTransaction.serialize());
                console.log("Transaction signature:", signature);

                // Așteaptă confirmarea tranzacției
                const confirmation = await connection.confirmTransaction(signature);
                if (confirmation.value.err) {
                    alert("Transaction failed!");
                } else {
                    alert("Transaction successful!");
                }

            } catch (error) {
                console.log("Buy failed: ", error);
            }
        });
    </script>
</body>
</html>
